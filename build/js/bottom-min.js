var controller={game:{},createGame:function(){this.game=new Phaser.Game(CANVAS_WIDTH,CANVAS_HEIGHT,Phaser.CANVAS,"game"),this.game.state.add("PreloadScene",PreloadScene),this.game.state.add("MainScene",MainScene),this.game.state.add("GameScene",GameScene),this.game.state.add("GameOverScene",GameOverScene),this.goToPreloadScene(),sizeHandler()},goToScene:function(e){this.game.state.start(e)},goToPreloadScene:function(){this.goToScene("PreloadScene")},goToMainScene:function(){this.goToScene("MainScene")},goToGameScene:function(){this.goToScene("GameScene")},goToGameOverScene:function(){this.goToScene("GameOverScene")}};const CANVAS_WIDTH=1080,CANVAS_HEIGHT=1920;var s_aSounds,s_bIsIphone=!1,g_coin=0,g_score=0,g_level=0,rotateAnimEase=function(e,t,i,a,s){let o=e.add.tween(t).to({angle:i},a,Phaser.Easing.Quadratic.InOut,!0);return s&&o.onComplete.add(s),o},rotateAnim=function(e,t,i,a,s){let o=e.add.tween(t).to({angle:i},a,Phaser.Easing.Linear.None,!0);return s&&o.onComplete.add(s),o},moveAnim=function(e,t,i,a,s,o){let n=e.add.tween(t).to({x:i,y:a},s,Phaser.Easing.Linear.None,!0);return o&&n.onComplete.add(o),n},scaleAnim=function(e,t,i,a,s,o){let n=e.add.tween(t.scale).to({x:i,y:a},s,Phaser.Easing.Linear.None,!0);return o&&n.onComplete.add(o),n},opacityAnim=function(e,t,i,a,s){let o=e.add.tween(t).to({alpha:i},a,Phaser.Easing.Linear.None,!0);return s&&o.onComplete.add(s),o},convertToNodeSpace=function(e,t,i){var a=i.worldPosition.x-i.anchor.x*i.width,s=i.worldPosition.y-i.anchor.y*i.height;return{x:e-=a,y:t-=s}},newButton=function(e,t,i,a,s,o,n,r,h,l,g,m,c,d,p,u,S){var f;if(c||(c=!1),d||(d=null),p||(p=2),u||(u=0),S||(S=1),c){var _=d.anchor;f=m.make.button(t-d.width*_.x,i-d.height*_.y,e,h,l,p,u,S),d.addChild(f)}else(f=m.add.button(t,i,e,h,l,p,u,S)).z_order=r,g.add(f);return f.onInputUp.add(function(){f.alpha=1},l),f.onInputDown.add(function(){f.alpha=.5},l),f.anchor.x=a,f.anchor.y=s,f.scale.x=o,f.scale.y=n,f},newLabelButton=function(e,t,i,a,s,o,n,r,h,l,g,m,c,d,p,u,S,f,_=0){const w=newButton(s,o,n,r,h,l,g,m,c,d,p,u,S,f);return newLabel(e,t,"Arial",a,w.width/2,w.height/2+_,.5,.5,1/l,1/g,1,p,u,!1,!0,w),null!==i&&(w.tint=i),w},newSpriteButton=function(e,t,i,a,s,o,n,r,h,l,g,m,c,d,p){const u=newButton("white",i,a,s,o,n,r,1,l,g,m,c,d,p);return newSprite(e,n,r,.5,.5,1/n,1/r,1,m,c,!0,u),u.tint=t,u},newSprite=function(e,t,i,a,s,o,n,r,h,l,g,m){var c;if(g||(g=!1),m||(m=null),g){var d=m.anchor;c=l.make.sprite((t-m.width*d.x)/m.scale.x,(i-m.height*d.y)/m.scale.y,e),m.addChild(c)}else(c=l.add.sprite(t,i,e)).z_order=r,null!==h&&h.add(c);return c.anchor.x=a,c.anchor.y=s,c.scale.x=o,c.scale.y=n,c},newLabel=function(e,t,i,a,s,o,n,r,h,l,g,m,c,d,p,u,S,f,_,w){var y;d||(d=!1),p||(p=!1),u||(u=null),S||(S="rgba(0, 0, 0, 0.5"),f||(f=5),_||(_=5),w||(w=5);var A={font:"bold "+t+"px "+i,fill:a,align:"center"};if(p){var I=u.anchor;y=c.make.text((s-u.width*I.x)/u.scale.x,(o-u.height*I.y)/u.scale.y,e,A),u.addChild(y)}else(y=c.add.text(s,o,e,A)).z_order=g,m.add(y);return y.anchor.x=n,y.anchor.y=r,y.scale.x=h,y.scale.y=l,d&&y.setShadow(f,_,S,w),y},convertSecondToMinute=function(e){var t=Math.floor(e/60),i=e%60;return(t<10?"0":"")+t+":"+(i<10?"0":"")+i},readGameData=function(e,t){return localStorage[e]?localStorage[e]:(saveGameData(e,t),t)},saveGameData=function(e,t){localStorage.setItem(e,t)},playSound=function(e,t,i){return s_aSounds[e].play(),s_aSounds[e].volume(t),s_aSounds[e].loop(i),s_aSounds[e]};function isIOS(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];for(-1!==navigator.userAgent.toLowerCase().indexOf("iphone")&&(s_bIsIphone=!0);e.length;)if(navigator.platform===e.pop())return!0;return s_bIsIphone=!1,!1}function sizeHandler(){window.scrollTo(0,1)}function calculateLandscapeSize(e,t){return CANVAS_HEIGHT/CANVAS_WIDTH<t/e}function getTimeStamp(){var e=new Date;return leadingZeros(e.getFullYear(),4)+"-"+leadingZeros(e.getMonth()+1,2)+"-"+leadingZeros(e.getDate(),2)+" "+leadingZeros(e.getHours(),2)+":"+leadingZeros(e.getMinutes(),2)+":"+leadingZeros(e.getSeconds(),2)}function leadingZeros(e,t){var a="";if((e=e.toString()).length<t)for(i=0;i<t-e.length;i++)a+="0";return a+e}function Item(e,t,i,a,s,o){this.type=e,this.row=t,this.floor=s,this.scene=o,this.choosed=!1,this.goneBag=!1,this.hasCoin=100*Math.random()>50;return this.sprite=newSprite("item"+e,i,a,.5,.5,.8,.8,s,this.scene.itemLayer,this.scene.game,0),this.rotateTween=rotateAnimEase(this.scene.game,this.sprite,this.sprite.angle+(100*Math.random()>50?1:-1)*(360*Math.random()+360),1e3*Math.random()+1e3,()=>{rotateAnimEase(this.scene.game,this.sprite,this.sprite.angle+(100*Math.random()>50?1:-1)*(360*Math.random()+360),1e3*Math.random()+1e3,()=>{this.rotateTween&&this.rotateTween.start()})}),this}$(window).resize(function(){sizeHandler()}),Item.prototype.destroy=function(){this.rotateTween.stop(),this.rotateTween=null,this.sprite.destroy()},Item.prototype.setPosition=function(e,t){this.sprite.x=e,this.sprite.y=t},Item.prototype.gotoBag=function(e){opacityAnim(this.scene.game,this.sprite,0,500),scaleAnim(this.scene.game,this.sprite,.5,.5,500),moveAnim(this.scene.game,this.sprite,e.x,e.y,500,()=>{this.goneBag=!0,this.scene.checkClear()})},Item.prototype.addAngle=function(e){this.sprite.angle+=e},Item.prototype.onClick=function(){this.scene.chooseChecker(this)&&this.choose(!0)};var MainScene={game:controller.game,init:function(){this.game.renderer.renderSession.roundPixels=!0,this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.pageAlignVertically=!0},preload:function(){},create:function(){this.isGameStarted=!0,this.group=this.game.add.group(),newSprite("bg",0,0,0,0,1,1,-1,this.group,this.game),newSprite("logo",320,390,.5,.5,1,1,1,this.group,this.game),newSprite("title",CANVAS_WIDTH/2,480,.5,0,1,1,-1,this.group,this.game),newSprite("gamii_logo",CANVAS_WIDTH/2,1600,.5,0,1,1,-1,this.group,this.game),this.btnPlay=newButton("btn_play",CANVAS_WIDTH/2,1200,.5,0,1,1,200,this.onClickPlay,this,this.group,this.game),this.waitTween=scaleAnim(this.game,this.btnPlay,.9,.9,500,()=>{scaleAnim(this.game,this.btnPlay,1,1,500,()=>{this.waitTween&&this.waitTween.start()})}),this.game.device.touch&&this.game.input.mouse.stop(),this.sort()},sort:function(){this.group.sort("z_order",Phaser.Group.SORT_ASCENDING)},onClickPlay:function(){controller.goToScene("GameScene")},onClickReplay:function(){window.location.reload()}};R2=1.4142,R3=1.732;var GameScene={game:controller.game,points:[],items:[],levelInfo:[],mainpos:[[[-250,-250],[0,-250],[250,-250],[-250,0],[0,0],[250,0],[-250,250],[0,250],[250,250]],[[-125,-250],[125,-250],[-125,0],[125,0],[-125,250],[125,250]],[[0,-300],[150*R3/2,-75],[-150*R3/2,-75],[-150*R3,150],[0,150],[150*R3,150]],[[0,-300],[-150*R3,150],[150*R3,150],[0,300],[-150*R3,-150],[150*R3,-150]],[[0,-300],[300,0],[0,300],[-300,0],[-300/R2,-300/R2],[300/R2,-300/R2],[-300/R2,300/R2],[300/R2,300/R2]]],init:function(){this.game.renderer.renderSession.roundPixels=!0,this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.pageAlignVertically=!0},preload:function(){},create:function(){this.isThrown=!1,this.group=this.game.add.group(),newSprite("bg",0,0,0,0,1,1,-1,this.group,this.game),newSprite("logo",320,390,.5,.5,1,1,1,this.group,this.game),this.pointLayer=this.game.add.group(),this.pointLayer.x=CANVAS_WIDTH/2,this.pointLayer.y=700,this.itemLayer=this.game.add.group(),this.itemLayer.alpha=0,this.uiLayer=this.game.add.group(),this.game.device.touch&&this.game.input.mouse.stop(),this.bGameOver=!1,this.nTotalScore=0,this.nSmallLevel=0,this.isThrown=!1,this.bObjCreated=!1,this.bag=newSprite("bag",200,1700,.5,.5,1,1,3,this.uiLayer,this.game),newSprite("level_bg",CANVAS_WIDTH/2,80,.5,.5,1,1,1,this.uiLayer,this.game),this.lblLabel=newLabel("Level  "+(g_level+1),50,"Arial","#FFFFFF",CANVAS_WIDTH/2,80,.5,.5,1,1,3,this.uiLayer,this.game),newSprite("progress_bg",CANVAS_WIDTH/2-184,160,0,.5,1,1,3,this.uiLayer,this.game),this.sProgress=newSprite("progress",CANVAS_WIDTH/2-184,160,0,.5,0,1,4,this.uiLayer,this.game),this.lblScore=newLabel("0",70,"Arial","#F32493",30,250,0,.5,1,1,3,this.uiLayer,this.game),this.sCoin=newSprite("coin",CANVAS_WIDTH-30,250,1,.5,1,1,3,this.uiLayer,this.game),this.lblCoin=newLabel(g_coin,70,"Arial","#F32493",CANVAS_WIDTH-150,250,1,.5,1,1,3,this.uiLayer,this.game),this.bgMissed=newSprite("bg_missed",0,0,0,0,1,1,-1,this.uiLayer,this.game),this.sMissed=newSprite("missed",CANVAS_WIDTH/2,1600,.5,.5,1,1,1,this.uiLayer,this.game),this.bgMissed.alpha=0,this.sMissed.alpha=0,this.createLevelInfo(g_level),this.createItems(),this.card=newSprite("throw1",CANVAS_WIDTH/2,1600,.5,.5,.7,.7,2,this.itemLayer,this.game),this.game.input.onUp.add(()=>{this.throwCard()}),this.sort()},createLevelInfo:function(e){this.levelInfo=[],this.nSmallLevel=0,this.nTotalItemCnt=0,this.nCollectedCnt=0;var t=Math.floor(e/10)+2;for(i=0;i<t;i++)this.levelInfo[i]=this.mainpos[Math.floor(5*Math.random())],this.nTotalItemCnt+=this.levelInfo[i].length;this.setProgress()},setProgress:function(){scaleAnim(this.game,this.sProgress,this.nCollectedCnt/this.nTotalItemCnt,1,200)},createItems:function(){if(this.bObjCreated=!1,this.points.length>0){for(i=0;i<this.items.length;i++)this.items[i].destroy(),this.points[i].destroy();this.items=[],this.points=[]}this.pointLayer.alpha=0,this.pointLayer.scale.x=.1,this.pointLayer.scale.y=.1,this.pointLayer.angle=180;let e=this.levelInfo[this.nSmallLevel];for(i=0;i<e.length;i++)this.points[i]=newSprite("point",e[i][0],e[i][1],.5,.5,1,1,1,this.pointLayer,this.game),this.items[i]=new Item(Math.ceil(15*Math.random()),i,this.points[i].x+this.pointLayer.x,this.points[i].y+this.pointLayer.y,1,this);scaleAnim(this.game,this.pointLayer,1,1,500),opacityAnim(this.game,this.pointLayer,1,500),rotateAnim(this.game,this.pointLayer,0,500,()=>{opacityAnim(this.game,this.itemLayer,1,500),this.bObjCreated=!0,this.startRotate()}),this.sort()},startRotate:function(){var e=Math.max(4e3-50*g_level,1e3);0==this.nSmallLevel?this.rotateTween=rotateAnim(this.game,this.pointLayer,360*(100*Math.random()>50?1:-1),e).loop(!0):this.rotateTween=rotateAnimEase(this.game,this.pointLayer,this.pointLayer.angle+(100*Math.random()>50?1:-1)*(360*Math.random()+180),e,()=>{rotateAnimEase(this.game,this.pointLayer,this.pointLayer.angle+(100*Math.random()>50?1:-1)*(360*Math.random()+180),e,()=>{this.rotateTween&&this.rotateTween.start()})})},sort:function(){this.group.sort("z_order",Phaser.Group.SORT_ASCENDING)},gameOver:function(){this.bGameOver=!0,this.game.tweens.removeAll(),this.bgMissed.alpha=1,g_score=this.nTotalScore,opacityAnim(this.game,this.sMissed,1,1e3,()=>{setTimeout(()=>{controller.goToGameOverScene()},500)})},throwCard:function(){this.bGameOver||this.isThrown||!this.bObjCreated||this.checkAllChoose()||(this.nCombo=0,this.hasScore=!1,this.isThrown=!0,rotateAnimEase(this.game,this.card,360,300),moveAnim(this.game,this.card,CANVAS_WIDTH/2,-100,300,()=>{this.hasScore?(this.card.y=1600,this.isThrown=!1):this.gameOver()}))},checkClear:function(){var e=!0;for(i=0;i<this.items.length;i++)this.items[i].goneBag||(e=!1);e&&(this.bObjCreated=!1,this.rotateTween.stop(),this.rotateTween=null,this.game.tweens.removeAll(),opacityAnim(this.game,this.itemLayer,0,500),scaleAnim(this.game,this.pointLayer,.1,.1,500),opacityAnim(this.game,this.pointLayer,0,500),rotateAnim(this.game,this.pointLayer,this.pointLayer.angle+180,500,()=>{this.nextLevel()}))},nextLevel:function(){if(this.nSmallLevel<this.levelInfo.length-1)this.nSmallLevel++;else{this.nSmallLevel=0,g_level++,this.lblLabel.text="Level  "+(g_level+1);let e=Math.ceil(3*Math.random())+7;for(i=0;i<e;i++)setTimeout(()=>{this.addCoin(this.bag.x,this.bag.y)},50*i);this.createLevelInfo(g_level)}this.createItems()},checkAllChoose:function(){var e=!0;for(i=0;i<this.items.length;i++)this.items[i].choosed||(e=!1);return e},onClickReplay:function(){window.location.reload()},presentTempLabel:function(e,t,i,a){var s=newLabel(e,50,"Arial",a,t,i,.5,.5,1,1,3,this.itemLayer,this.game);opacityAnim(this.game,s,0,500),moveAnim(this.game,s,t,i-100,500,()=>{s.destroy()})},addCoin:function(e,t){var i=newSprite("coin",e,t,.5,.5,.5,.5,3,this.uiLayer,this.game);moveAnim(this.game,i,this.sCoin.x,this.sCoin.y,400+100*Math.random(),()=>{g_coin++,this.lblCoin.text=g_coin,i.destroy()})},update:function(){if(this.bObjCreated&&!this.bGameOver)for(i=0;i<this.points.length;i++)this.items[i].choosed||(this.items[i].setPosition(this.points[i].world.x,this.points[i].world.y),this.isThrown&&Phaser.Math.distance(this.items[i].sprite.x,this.items[i].sprite.y,this.card.position.x,this.card.position.y)<150&&(this.items[i].choosed=!0,this.items[i].gotoBag(this.bag.position),this.hasScore=!0,this.nCombo++,score=Math.pow(2,this.nCombo-1),this.presentTempLabel("+ "+score,this.items[i].sprite.x,this.items[i].sprite.y,"#F32493"),this.nTotalScore+=score,this.lblScore.text=this.nTotalScore,this.items[i].hasCoin&&this.addCoin(this.items[i].sprite.x,this.items[i].sprite.y),this.nCollectedCnt++,this.setProgress()))}},GameOverScene={game:controller.game,init:function(){this.game.renderer.renderSession.roundPixels=!0,this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.pageAlignVertically=!0},preload:function(){},create:function(){this.isGameStarted=!0,this.group=this.game.add.group(),newSprite("bg_gameover",0,0,0,0,1,1,-1,this.group,this.game),newSprite("logo",320,390,.5,.5,1,1,1,this.group,this.game),this.game.device.touch&&this.game.input.mouse.stop(),newLabel("Level  "+(g_level+1),70,"Arial","#FFF",CANVAS_WIDTH/2,750,.5,.5,1,1,2,this.group,this.game),newLabel(g_score,100,"Arial","#FFF",CANVAS_WIDTH/2,900,.5,.5,1,1,2,this.group,this.game),newButton("btn_replay",340,1600,.5,.5,1,1,3,this.onClickReplay,this,this.group,this.game),this.sort()},sort:function(){this.group.sort("z_order",Phaser.Group.SORT_ASCENDING)},onClickShop:function(){},onClickReplay:function(){controller.goToScene("GameScene")}},cnt_files=0,cnt_loaded_files=0,PreloadScene={game:controller.game,lblProgress:{},init:function(){this.game.renderer.renderSession.roundPixels=!0,this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.pageAlignVertically=!0},preload:function(){},create:function(){this.game.stage.backgroundColor="#000",this.group=this.game.add.group(),this.lblProgress=newLabel("",20,"digital","white",CANVAS_WIDTH/2,CANVAS_HEIGHT/2,.5,.5,1,1,1,this.group,this.game),this.game.load.onLoadStart.add(this.loadStart,this),this.game.load.onFileComplete.add(this.fileComplete,this),this.game.load.onLoadComplete.add(this.loadComplete,this),this.start()},start:function(){cnt_files=0;const e="./resources/images";this.loadImage("bg",`${e}/bg.jpg`),this.loadImage("logo",`${e}/logo.png`),this.loadImage("btn_play",`${e}/btn_play.png`),this.loadImage("gamii_logo",`${e}/gamii_logo.png`),this.loadImage("title",`${e}/title.png`),this.loadImage("bg_missed",`${e}/bg_missed.png`),this.loadImage("missed",`${e}/missed.png`),this.loadImage("coin",`${e}/coin.png`),this.loadImage("level_bg",`${e}/level_bg.png`),this.loadImage("progress_bg",`${e}/progress_bg.png`),this.loadImage("progress",`${e}/progress.png`),this.loadImage("score_bg",`${e}/score_bg.png`),this.loadImage("bg_gameover",`${e}/bg_gameover.jpg`),this.loadImage("btn_replay",`${e}/btn_replay.png`),this.loadImage("btn_shop1",`${e}/btn_shop1.png`),this.loadImage("point",`${e}/point.png`),this.loadImage("item1",`${e}/item_1.png`),this.loadImage("item2",`${e}/item_2.png`),this.loadImage("item3",`${e}/item_3.png`),this.loadImage("item4",`${e}/item_4.png`),this.loadImage("item5",`${e}/item_5.png`),this.loadImage("item6",`${e}/item_6.png`),this.loadImage("item7",`${e}/item_7.png`),this.loadImage("item8",`${e}/item_8.png`),this.loadImage("item9",`${e}/item_9.png`),this.loadImage("item10",`${e}/item_10.png`),this.loadImage("item11",`${e}/item_11.png`),this.loadImage("item12",`${e}/item_12.png`),this.loadImage("item13",`${e}/item_13.png`),this.loadImage("item14",`${e}/item_14.png`),this.loadImage("item15",`${e}/item_15.png`),this.loadImage("throw1",`${e}/throw_1.png`),this.loadImage("throw2",`${e}/throw_2.png`),this.loadImage("throw3",`${e}/throw_3.png`),this.loadImage("throw4",`${e}/throw_4.png`),this.loadImage("throw5",`${e}/throw_5.png`),this.loadImage("throw6",`${e}/throw_6.png`),this.loadImage("throw7",`${e}/throw_7.png`),this.loadImage("throw8",`${e}/throw_8.png`),this.loadImage("throw9",`${e}/throw_9.png`),this.loadImage("bag",`${e}/shopping_bag.png`);var t=[];t.push({filename:"./resources/sounds/click",loop:!1,volume:1,ingamename:"click"}),cnt_files+=t.length,s_aSounds=[];for(var i=0;i<t.length;i++)s_aSounds[t[i].ingamename]=new Howl({src:[t[i].filename+".mp3",`${t[i].path}${t[i].filename}.ogg`],autoplay:!1,preload:!0,loop:t[i].loop,volume:t[i].volume,onload:this.fileComplete()});cnt_loaded_files=0,this.game.load.start()},loadSound:function(e,t){cnt_files++,this.game.load.audio(e,[t])},loadImage:function(e,t,i,a,s,o){i||(i=!1),a||(a=-1),s||(s=-1),o||(o=-1),cnt_files++,i?this.game.load.spritesheet(e,t,a,s,o):this.game.load.image(e,t)},loadStart:function(){this.lblProgress.text="Loading: 0%"},fileComplete:function(e){cnt_loaded_files++,this.lblProgress.text="Loading: "+Math.floor(cnt_loaded_files/cnt_files*100)+"%"},loadComplete:function(){controller.goToScene("MainScene")}};